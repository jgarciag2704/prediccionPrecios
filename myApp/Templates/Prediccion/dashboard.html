{% extends 'layouts/base.html' %}
{% load static %}
{% block content %}
    <h1>{{ title }}</h1>
    <form method="POST">
        {% csrf_token %}
        <label for="nombreSelect">Selecciona un producto:</label>
        <select id="nombreSelect" name="nombre" onchange="this.form.submit()">
            <option value="">-- Selecciona --</option>
            {% for nombre in nombres %}
                <option value="{{ nombre }}" {% if nombre == request.POST.nombre %}selected{% endif %}>{{ nombre }}</option>
            {% endfor %}
        </select>
    </form>

    <script src="https://code.highcharts.com/highcharts.js"></script>

    <figure class="highcharts-figure">
        <div id="container"></div>
    </figure>

    <script>
        
        document.addEventListener("DOMContentLoaded", function() {
            let precios =JSON.parse('{{ precios|safe|escapejs }}');
            let dataSeries = precios.map(item => [new Date(item.fecha).getTime(), item.precioPromedio]);

            Highcharts.chart('container', {
                chart: { type: 'spline' },
                title: { text: 'Hist√≥rico de Precios' },
                xAxis: { type: 'datetime' },
                yAxis: { title: { text: 'Precio Promedio' } },
                series: [{
                    name: "Precio Promedio",
                    data: dataSeries
                }]
            });
        });
    </script>

{% endblock %}
