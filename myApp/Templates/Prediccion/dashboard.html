{% extends 'layouts/base.html' %}
{% load static %}
{% block content %}
    <h1>{{ title }}</h1>
    <form method="POST">
        {% csrf_token %}
        <label for="nombreSelect">Selecciona un producto:</label>
        <select id="nombreSelect" name="nombre" onchange="this.form.submit()">
            <option value="">-- Selecciona --</option>
            {% for nombre in nombres %}
                <option value="{{ nombre }}" {% if nombre == request.POST.nombre %}selected{% endif %}>{{ nombre }}</option>
            {% endfor %}
        </select>
    </form>
    <p id="presentacionLabel"><strong>Presentación:</strong> {{ presentacion }}</p>
    <p id="mercadoLabel"><strong>Presentación:</strong> {{ mercado }}</p>

    <script src="https://code.highcharts.com/highcharts.js"></script>

    <figure class="highcharts-figure">
        <div id="container"></div>
    </figure>

    <!-- Guardamos precios en un script seguro -->
    <script id="data-precios" type="application/json">{{ precios|safe }}</script>
    <script id="data-predicciones" type="application/json">{{ predicciones|safe }}</script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let precios = JSON.parse(document.getElementById("data-precios").textContent);
            let predicciones = JSON.parse(document.getElementById("data-predicciones").textContent);

            let dataSeries = precios.map(item => [Date.parse(item.fecha), item.precioPromedio]);

            // Crear los datos para las predicciones
            let prediccionSeries = predicciones.map(item => [Date.parse(item.fecha), item.precio]);

            // Crear el gráfico
            Highcharts.chart('container', {
                chart: { 
                    type: 'spline' 
                },
                title: { 
                    text: 'Histórico de Precios y Predicciones Futuras' 
                },
                xAxis: { 
                    type: 'datetime' 
                },
                yAxis: { 
                    title: { 
                        text: 'Precio Promedio' 
                    }
                },
                series: [{
                    name: "Precio Promedio Histórico",
                    data: dataSeries
                }, {
                    name: "Predicciones Futuras",
                    data: prediccionSeries,
                    dashStyle: 'ShortDash',  // Estilo de línea discontinua para las predicciones
                    color: 'red'  // Puedes elegir el color que prefieras
                }]
            });
        });
    </script>


{% endblock %}
